<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HAUS TAINACH – Web 3D / AR</title>

  <!-- IMPORTANT: use a pinned, stable version -->
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#07080a;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    model-viewer{width:100%;height:100vh;display:block;background:radial-gradient(1200px 700px at 50% 25%, rgba(255,255,255,.07), rgba(0,0,0,.92))}
    #hud{
      position:fixed;left:12px;top:12px;z-index:9999;max-width:min(680px,calc(100% - 24px));
      background:rgba(20,20,22,.78);backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.14);border-radius:14px;padding:10px 12px;color:#fff;
      box-shadow:0 16px 50px rgba(0,0,0,.55);font-size:12px;line-height:1.35
    }
    #hud b{font-weight:800}
    #hud .ok{color:#4be37a}
    #hud .bad{color:#ff5d5d}
    #hud .muted{opacity:.75}
    #hud code{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);padding:1px 6px;border-radius:999px}
    #hud .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:6px}
    #hud button{
      appearance:none;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.10);color:#fff;
      border-radius:12px;padding:7px 10px;font-size:12px;cursor:pointer
    }
    #hud button:hover{background:rgba(255,255,255,.14)}
  </style>
</head>

<body>
  <div id="hud">
    <div><b>Debug</b> <span class="muted">– wenn hier alles grün ist, muss das Modell sichtbar sein</span></div>
    <div class="row">
      <span id="mvStatus" class="muted">model-viewer: …</span>
      <span id="webglStatus" class="muted">WebGL: …</span>
      <span id="glbStatus" class="muted">GLB: …</span>
    </div>
    <div class="row">
      <span class="muted">Erwartete Datei:</span>
      <code id="glbUrl">HAUSTAINACH.glb</code>
      <button id="reload" type="button">Neu laden</button>
      <button id="openGlb" type="button">GLB öffnen</button>
    </div>
    <div id="err" class="muted" style="margin-top:6px"></div>
  </div>

  <model-viewer
    id="mv"
    src="HAUSTAINACH.glb"
    camera-controls
    auto-rotate
    rotation-per-second="10deg"
    interaction-prompt="none"
    loading="eager"
    reveal="auto"
    tone-mapping="aces"
    exposure="1.15"
    shadow-intensity="0.9"
    shadow-softness="0.65"
    environment-image="neutral"
    ar
    ar-modes="webxr scene-viewer quick-look"
  ></model-viewer>

  <script type="module">
    const mv = document.getElementById('mv');
    const mvStatus = document.getElementById('mvStatus');
    const webglStatus = document.getElementById('webglStatus');
    const glbStatus = document.getElementById('glbStatus');
    const err = document.getElementById('err');

    // 1) model-viewer loaded?
    const mvDefined = !!customElements.get('model-viewer');
    mvStatus.innerHTML = mvDefined
      ? '<span class="ok">model-viewer: OK</span>'
      : '<span class="bad">model-viewer: NICHT geladen (Script geblockt?)</span>';

    // 2) WebGL support?
    function hasWebGL(){
      try{
        const c=document.createElement('canvas');
        return !!(c.getContext('webgl') || c.getContext('experimental-webgl') || c.getContext('webgl2'));
      }catch{return false;}
    }
    webglStatus.innerHTML = hasWebGL()
      ? '<span class="ok">WebGL: OK</span>'
      : '<span class="bad">WebGL: NICHT verfügbar</span>';

    // 3) GLB reachable?
    const glbUrl = new URL('HAUSTAINACH.glb', location.href).toString();
    document.getElementById('glbUrl').textContent = glbUrl;

    async function checkGlb(){
      try{
        const r = await fetch(glbUrl, { method:'HEAD', cache:'no-store' });
        if (!r.ok){
          glbStatus.innerHTML = `<span class="bad">GLB: ${r.status} ${r.statusText}</span>`;
          err.textContent = 'Fix: Datei muss exakt im Repo-Root liegen und exakt so heißen (Groß/Kleinschreibung!).';
          return;
        }
        const len = r.headers.get('content-length');
        glbStatus.innerHTML = `<span class="ok">GLB: OK</span>` + (len ? ` <span class="muted">(${(Number(len)/1024/1024).toFixed(2)} MB)</span>` : '');
        err.textContent = '';
      }catch(e){
        glbStatus.innerHTML = `<span class="bad">GLB: Fehler beim Abruf</span>`;
        err.textContent = String(e);
      }
    }
    await checkGlb();

    // model-viewer events
    mv.addEventListener('load', () => {
      err.innerHTML = '<span class="ok">Modell geladen ✅</span>';
    });
    mv.addEventListener('error', (e) => {
      console.error(e);
      err.innerHTML = '<span class="bad">model-viewer error:</span> ' + (e?.detail?.message || 'unbekannt');
    });

    // Buttons
    document.getElementById('reload').onclick = () => location.reload();
    document.getElementById('openGlb').onclick = () => window.open(glbUrl, '_blank');
  </script>
</body>
</html>
