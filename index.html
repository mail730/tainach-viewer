<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>HAUS TAINACH</title>
<script type="module" src="https://unpkg.com/@google/model-viewer@3.5.0/dist/model-viewer.min.js"></script>

<style>
:root{
  --bg:#07080a;
  --panel:rgba(20,20,22,.78);
  --stroke:rgba(255,255,255,.12);
  --txt:#fff;
  --muted:rgba(255,255,255,.68);
  --good:#4be37a;
  --warn:#f7c948;
  --bad:#ff5d5d;
  --r:14px;
}
html,body{margin:0;height:100%;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto;}
model-viewer{width:100%;height:100vh;display:block;background:radial-gradient(1200px 700px at 50% 25%, rgba(255,255,255,.07), rgba(0,0,0,.92));}

/* Top bar */
.topbar{
  position:fixed; left:8px; right:8px; top:8px;
  display:flex; justify-content:space-between; gap:8px; align-items:center;
  z-index:30; pointer-events:none;
}
.badges{display:flex; gap:6px; flex-wrap:wrap; pointer-events:auto;}
.pill{
  display:inline-flex;align-items:center;gap:6px;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.10);
  color:var(--muted);font-size:11px;user-select:none;
}
.dot{width:8px;height:8px;border-radius:50%;background:var(--warn);}
.dot.ok{background:var(--good);}
.dot.bad{background:var(--bad);}

.btn{
  pointer-events:auto;
  appearance:none;border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.10);
  color:#fff;border-radius:12px;
  padding:7px 10px;font-size:11px;cursor:pointer;
}
.btn:active{transform:scale(.97)}

/* ✅ BIG RED menu button */
#togglePanel{
  font-size:22px;
  padding:14px 18px;
  min-width:56px;
  min-height:56px;
  border-radius:16px;
  line-height:1;
  display:flex;
  align-items:center;
  justify-content:center;

  background:#e53935;
  border:1px solid rgba(255,255,255,.28);
  box-shadow: 0 10px 28px rgba(229,57,53,.35);
}
#togglePanel:hover{background:#ff3b30;}
#togglePanel:active{transform:scale(.98);}

/* Collapsible panel */
.panel{
  position:fixed;
  left:8px; right:8px; top:68px;
  z-index:25;
  pointer-events:auto;
  background:var(--panel);
  border:1px solid var(--stroke);
  border-radius:var(--r);
  backdrop-filter:blur(12px);
  color:var(--txt);
  padding:10px;
  max-width:560px;
}
.panel.collapsed{padding:8px 10px;}
.panel.collapsed .content{display:none;}
.header{display:flex;align-items:center;justify-content:space-between;gap:10px;}
.title{font-size:13px;font-weight:800;margin:0;}
.subtitle{font-size:11px;color:var(--muted);margin:0;}

.row{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-top:8px;}
.sliderRow{display:flex;align-items:center;gap:8px;margin-top:8px;}
.sliderRow label{font-size:11px;color:var(--muted);width:52px;}
input[type="range"]{flex:1;height:22px;}
.value{font-size:11px;width:64px;text-align:right;color:var(--muted);}

@media (min-width: 900px){
  .panel{left:12px;right:auto;top:84px;width:520px}
  .topbar{left:12px;right:12px;top:12px}
}
</style>
</head>

<body>

<div class="topbar">
  <div class="badges">
    <span class="pill"><span id="mDot" class="dot"></span><span id="mTxt">Lädt…</span></span>
    <span class="pill"><span id="pDot" class="dot"></span><span id="pTxt">Pano: prüfen…</span></span>
  </div>
  <button id="togglePanel" class="btn" type="button" aria-label="Menü">☰</button>
</div>

<div id="panel" class="panel collapsed">
  <div class="header">
    <div>
      <div class="title">HAUS TAINACH · 360°</div>
      <div class="subtitle">Pano Toggle · Scale/Yaw/Zoom/FOV</div>
    </div>
    <div class="row" style="margin-top:0">
      <button id="reset" class="btn" type="button">Reset</button>
      <button id="rotateBtn" class="btn" type="button">Rotate</button>
      <button id="fs" class="btn" type="button">Full</button>
    </div>
  </div>

  <div class="content">
    <div class="row">
      <button id="panoOn"  class="btn" type="button">Pano ON</button>
      <button id="panoOff" class="btn" type="button">Pano OFF</button>
    </div>

    <div class="sliderRow">
      <label>Scale</label>
      <input id="scale" type="range" min="6" max="20" step="1" value="12"/>
      <div class="value" id="scaleVal">12x</div>
    </div>

    <div class="sliderRow">
      <label>Yaw</label>
      <input id="yaw" type="range" min="-180" max="180" step="1" value="-90"/>
      <div class="value" id="yawVal">-90°</div>
    </div>

    <div class="sliderRow">
      <label>Zoom</label>
      <input id="dist" type="range" min="40" max="1200" step="10" value="320"/>
      <div class="value" id="distVal">320m</div>
    </div>

    <div class="sliderRow">
      <label>FOV</label>
      <input id="fov" type="range" min="25" max="70" step="1" value="50"/>
      <div class="value" id="fovVal">50°</div>
    </div>
  </div>
</div>

<model-viewer
  id="mv"
  src="HAUS_TAINACH.glb"
  camera-controls
  auto-rotate
  rotation-per-second="10deg"
  interaction-prompt="none"
  loading="eager"
  reveal="auto"

  tone-mapping="aces"
  exposure="1.10"
  shadow-intensity="0.90"
  shadow-softness="0.65"

  environment-image="neutral"

  orientation="90deg -90deg 0deg"
  scale="12 12 12"

  camera-orbit="45deg 65deg 320m"
  min-camera-orbit="auto auto 0.2m"
  max-camera-orbit="auto auto 8000m"
  field-of-view="50deg"
></model-viewer>

<script>
const mv = document.getElementById("mv");

// Status
const mDot = document.getElementById("mDot");
const mTxt = document.getElementById("mTxt");
const pDot = document.getElementById("pDot");
const pTxt = document.getElementById("pTxt");

// Panel
const panel = document.getElementById("panel");
document.getElementById("togglePanel").onclick = () => panel.classList.toggle("collapsed");

// Inputs
const scale = document.getElementById("scale");
const yaw   = document.getElementById("yaw");
const dist  = document.getElementById("dist");
const fov   = document.getElementById("fov");

// Labels
const scaleVal = document.getElementById("scaleVal");
const yawVal   = document.getElementById("yawVal");
const distVal  = document.getElementById("distVal");
const fovVal   = document.getElementById("fovVal");

const PANO_FILE = "TAINACH_PANO.jpg";

async function headOk(rel){
  try{
    const url = new URL(rel, location.href).toString();
    const r = await fetch(url, { method:"HEAD", cache:"no-store" });
    return r.ok;
  }catch{ return false; }
}

function setCameraDistance(meters){
  const orbit = mv.getCameraOrbit();
  mv.cameraOrbit = `${orbit.theta}rad ${orbit.phi}rad ${meters}m`;
}

function updateAll(){
  const s = Number(scale.value);
  const y = Number(yaw.value);
  const d = Number(dist.value);
  const f = Number(fov.value);

  mv.setAttribute("scale", `${s} ${s} ${s}`);
  mv.setAttribute("orientation", `90deg ${y}deg 0deg`);
  setCameraDistance(d);
  mv.fieldOfView = `${f}deg`;

  scaleVal.textContent = `${s}x`;
  yawVal.textContent   = `${y}°`;
  distVal.textContent  = `${d}m`;
  fovVal.textContent   = `${f}°`;
}

async function panoOn(){
  const ok = await headOk(PANO_FILE);
  if (!ok){
    pDot.className = "dot bad";
    pTxt.textContent = `Pano fehlt`;
    mv.setAttribute("environment-image","neutral");
    mv.removeAttribute("skybox-image");
    return;
  }
  mv.setAttribute("environment-image", PANO_FILE);
  mv.setAttribute("skybox-image", PANO_FILE);
  pDot.className = "dot ok";
  pTxt.textContent = "Pano: ON";
  mv.requestRender();
}

function panoOff(){
  mv.setAttribute("environment-image","neutral");
  mv.removeAttribute("skybox-image");
  pDot.className = "dot ok";
  pTxt.textContent = "Pano: OFF";
  mv.requestRender();
}

document.getElementById("panoOn").onclick  = () => panoOn();
document.getElementById("panoOff").onclick = () => panoOff();

document.getElementById("reset").onclick = () => {
  mv.cameraOrbit = "45deg 65deg 320m";
  mv.fieldOfView = "50deg";
};

document.getElementById("rotateBtn").onclick = () => {
  if (mv.hasAttribute("auto-rotate")) mv.removeAttribute("auto-rotate");
  else mv.setAttribute("auto-rotate","");
};

document.getElementById("fs").onclick = () => {
  if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
  else document.exitFullscreen().catch(()=>{});
};

mv.addEventListener("load", async () => {
  mDot.className = "dot ok";
  mTxt.textContent = "Modell bereit";

  yaw.value = "-90"; // Startwert fix
  updateAll();

  pDot.className = "dot";
  pTxt.textContent = "Pano: laden…";
  await panoOn();
});

mv.addEventListener("error", (e) => {
  mDot.className = "dot bad";
  mTxt.textContent = "Modell Fehler";
  console.error(e);
});

scale.oninput = updateAll;
yaw.oninput   = updateAll;
dist.oninput  = updateAll;
fov.oninput   = updateAll;
</script>

</body>
</html>
